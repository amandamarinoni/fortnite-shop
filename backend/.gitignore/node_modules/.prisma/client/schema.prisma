generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --- USUÁRIO ---
model User {
  id            String   @id @default(uuid())
  email         String   @unique
  passwordHash  String
  displayName   String?
  vbucksBalance Int      @default(10000)
  createdAt     DateTime @default(now())

  inventory    UserItem[]
  transactions Transaction[]
}

// --- COSMÉTICO (ITEM DA LOJA) ---
model Cosmetic {
  id         String @id @default(uuid())
  externalId String @unique
  name       String

  description String? // <--- ESTE CAMPO FOI ADICIONADO

  type        String
  rarity      String
  priceVbucks Int
  imageUrl    String?

  isNew        Boolean  @default(false)
  isOnShop     Boolean  @default(false)
  lastSyncedAt DateTime @default(now())

  owners UserItem[]
}

// --- INVENTÁRIO (O QUE O USUÁRIO TEM) ---
model UserItem {
  id String @id @default(uuid())

  user   User   @relation(fields: [userId], references: [id])
  userId String

  cosmetic   Cosmetic @relation(fields: [cosmeticId], references: [id])
  cosmeticId String

  acquiredAt DateTime @default(now())

  @@unique([userId, cosmeticId])
}

// --- EXTRATO FINANCEIRO ---
model Transaction {
  id     String @id @default(uuid())
  user   User   @relation(fields: [userId], references: [id])
  userId String

  type        TransactionType
  amount      Int
  itemId      String?
  description String

  createdAt DateTime @default(now())
}

enum TransactionType {
  INITIAL_BONUS
  PURCHASE
  REFUND
}
