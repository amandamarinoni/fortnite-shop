FROM node:20-alpine

# 1. Instala OpenSSL (necessário para o Prisma)
RUN apk add --no-cache openssl

# Define o diretório de trabalho
WORKDIR /usr/src/app

# 2. COPIA CRÍTICA: Copia APENAS package.json e package-lock.json.
# O source e o destino são explícitos.
COPY package*.json ./ 

# 3. Instala as dependências (Agora o package.json existe)
RUN npm install 
RUN npx prisma generate

# 4. Copia o restante do código (incluindo src, controllers, prisma/)
COPY . .

# 5. Garante permissão de execução
RUN chmod -R +x .

# 6. Compila e Inicia
RUN npm run build 
CMD ["npm", "start"]